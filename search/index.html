<!DOCTYPE html>
<html >
<head>
	<meta charset="utf-8">
	<title>Word Search</title>
	<meta name="description" content="Word Search Game">
	<meta name="author" content="Andrew Ippoliti">

	<!-- Mobile viewport optimization http://goo.gl/b9SaQ -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=320, height=320, user-scalable=no" />
	
	<!-- Hide browser chrome (iOS only) -->
	<meta name="apple-mobile-web-app-capable" content="yes" />	
	<link rel="stylesheet" href="../resources/styles/default.css" />

	<style type="text/css">
		
		*, *:before, *:after {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
		}

		html, body {

			font-size: 24px;

			overflow: hidden;

			margin: 0;
			padding: 0;
			position: relative;

			-webkit-user-select: none; 
			-webkit-touch-callout: none;
			-webkit-tap-highlight-color: transparent;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		#word-search-puzzle {position: absolute; }
		#word-message {position: absolute;}
		#word-list-container {
			position:absolute; overflow: scroll; text-align: center;
			padding: 1em;
		}
		#word-list {}

		.letter { padding: none; margin: none; position: absolute; text-align: center;}

		ul { display: inline-block; margin: 0; padding: 0; list-style-type: none; }
		li { list-style-type: none; float: left; }

	</style>

	<style type="text/css" id="dynamic-css"></style>

	<script type="text/javascript" src="../resources/lib/jquery.min.js"></script>
	<script type="text/javascript" src="../resources/lib/hammer.min.js"></script>
	<script type="text/javascript" src="../resources/lib/elementFromPoint.js"></script>
	<script type="text/javascript" src="../resources/lib/random.js"></script>

</head>
<body >
	<div id='word-search-puzzle'>
		<div class='letter' id='letter_0_0'>A</div>
		<div class='letter' id='letter_0_1'>A</div>
		<div class='letter' id='letter_0_2'>A</div>
		<div class='letter' id='letter_0_3'>A</div>
		<div class='letter' id='letter_0_4'>A</div>
		<div class='letter' id='letter_0_5'>A</div>
		<div class='letter' id='letter_0_6'>A</div>
		<div class='letter' id='letter_0_7'>A</div>

		<div class='letter' id='letter_1_0'>A</div>
		<div class='letter' id='letter_1_1'>A</div>
		<div class='letter' id='letter_2_2'>A</div>
		<div class='letter' id='letter_3_3'>A</div>
		<div class='letter' id='letter_4_4'>A</div>
		<div class='letter' id='letter_5_5'>A</div>
		<div class='letter' id='letter_6_6'>A</div>
		<div class='letter' id='letter_7_7'>A</div>

		<div class='letter' id='letter_7_0'>A</div>
		<div class='letter' id='letter_7_1'>A</div>
		<div class='letter' id='letter_7_2'>A</div>
		<div class='letter' id='letter_7_3'>A</div>
		<div class='letter' id='letter_7_4'>A</div>
		<div class='letter' id='letter_7_5'>A</div>
		<div class='letter' id='letter_7_6'>A</div>
		<div class='letter' id='letter_6_7'>A</div>
	</div>
	<div id='word-message'></div>
	<div id='word-list-container'><ul id='word-list'>
		<li>word123</li>
		<li>word1</li>
		<li>word23</li>
		<li>word546</li>
		<li>wor51d</li>
		<li>word57</li>
		<li>word526</li>
		<li>word4124</li>
		<li>word421</li>
		<li>word42</li>
		<li>word</li>
		<li>word123</li>
		<li>word1</li>
		<li>word23</li>
		<li>word546</li>
		<li>wor51d</li>
		<li>word57</li>
		<li>word526</li>
		<li>word4124</li>
		<li>word421</li>
		<li>word42</li>
		<li>word</li>
		</ul></div>
	
<script type="text/javascript">

// ----------------------------------------------- [ Module: Game ] -
(function () {
  // Game State
  var N_LETTERS_X = 8;
  var N_LETTERS_Y = 8;

  var MAX_WORD_SIZE = Math.max(N_LETTERS_X,N_LETTERS_Y);

  var MIN_SIZE_RATIO = 0.68;
  var LIST_FONT_SCALE = 0.5;

  var CLASS_PUZZLE_LETTER = '.letter';

  var SELECTOR_WORD = 'li';

  var ID_LETTER_PREFIX = '#letter_';
  var ID_LETTER_SEP = '_';

  var ID_DYNAMIC_CSS = '#dynamic-css';

  var ID_PUZZLE = '#word-search-puzzle';
  var ID_LIST = '#word-list';
  var ID_LIST_CONTAINER = '#word-list-container';
  var ID_MESSAGE = '#word-message';

  // Resizes the UI
  function uiResize() {
    var $window = $(window);
    var windowSizeX = $window.width();
    var windowSizeY = $window.height();
    $('body').width(windowSizeX).height(windowSizeY);

    var $puzzle = $(ID_PUZZLE);
    var $listContainer = $(ID_LIST_CONTAINER);
    var $list = $(ID_LIST);

    // Make the puzzle the smaller of the width/height
    // but if it's squarish, make sure there is room for the word list
    var listWidth, listHeight;
    var smallerSize = windowSizeX;
    if( windowSizeX > windowSizeY ){
      smallerSize = windowSizeY;
      if( smallerSize > windowSizeX * MIN_SIZE_RATIO ){
        smallerSize = windowSizeX * MIN_SIZE_RATIO;
      }
      $puzzle.css({
        left: '0px',
        width: smallerSize-2+'px',
        height: smallerSize-2+'px',
        top: (windowSizeY-smallerSize)/2 + 'px'
      });
      $listContainer.css({
        left: smallerSize + 'px',
        top: '0px',
        width: (windowSizeX-smallerSize)+'px',
        height: windowSizeY+'px'
      });
      listWidth = windowSizeX-smallerSize;
      listHeight = windowSizeY;
    }else{
      if( smallerSize > windowSizeY * MIN_SIZE_RATIO ){
        smallerSize = windowSizeY * MIN_SIZE_RATIO;
      }
      $puzzle.css({
        left: (windowSizeX-smallerSize)/2+'px',
        width: (smallerSize-2)+'px',
        height: (smallerSize-2)+'px',
        top: '0px'
      });
      $listContainer.css({
        left: '0px',
        top: smallerSize+'px',
        width: windowSizeX+'px',
        height: (windowSizeY-smallerSize)+'px'
      });
      listWidth = windowSizeX;
      listHeight = windowSizeY-smallerSize;
    }

    // Size the fonts
    var puzzleFontSize = smallerSize / N_LETTERS_X;
    if( N_LETTERS_X < N_LETTERS_Y ){
      puzzleFontSize = smallerSize / N_LETTERS_Y;
    }
    $puzzle.css( { fontSize: puzzleFontSize } );

    var dynamicCss = '';
    dynamicCss += CLASS_PUZZLE_LETTER +' { ';
    dynamicCss += 'font-size:'+puzzleFontSize+'px; ';
    dynamicCss += 'width:'+puzzleFontSize+'px; ';
    dynamicCss += 'height:'+puzzleFontSize+'px; ';
    dynamicCss += '}\n';

    // Adjust the size of the word list
    var listFontSize = puzzleFontSize * LIST_FONT_SCALE;
    var listWordWidth = listFontSize * MAX_WORD_SIZE;
    var nWordsWide = listWidth / (listFontSize * MAX_WORD_SIZE);
    var nWordsTall = listHeight / (listFontSize);
    dynamicCss += ID_LIST + ' { ';
    dynamicCss += 'font-size:'+listFontSize+'px; ';
    dynamicCss += '}\n';
    dynamicCss += SELECTOR_WORD + ' { ';
    dynamicCss += 'width: '+ listFontSize * (MAX_WORD_SIZE-1) +'px;';
    dynamicCss += '}\n';

    $(ID_LIST).width( Math.max(1,Math.floor(listWidth/listWordWidth) ) * listWordWidth );

    $(ID_DYNAMIC_CSS).html(dynamicCss);

    // Adjust the positions of all of the puzzle letters:
    var x,y;
    for( x=0; x<N_LETTERS_X; x+=1 ){
      for( y=0; y<N_LETTERS_Y; y+=1 ){
        $( ID_LETTER_PREFIX + x + ID_LETTER_SEP + y ).css({
          left:x*puzzleFontSize, 
          top: y*puzzleFontSize
        });
      }
    }
    

  }
  
  // Size the viewport optimally and enable keyboard support
  $(window).on('resize', uiResize);

  // Enable scrolling of the word list
  var START_SCROLL_X = 0;
  var START_SCROLL_Y = 0;
  $(ID_LIST_CONTAINER).hammer().on('touch drag',function(ev){
    /*
    var $this = $(this);
    var currentPosition = $this.position();
    var x = currentPosition.left;
    var y = currentPosition.top;

    console.info(ev.gesture);

    ev.gesture.preventDefault();

    $this.css({
      top: y+ ev.gesture.deltaY,
      left: x+ ev.gesture.deltaX
    });
    */
    ev.gesture.preventDefault();
    if( ev.type === 'touch' ){
      START_SCROLL_Y = $(this).clearQueue().scrollTop();
    }
    if( ev.type === 'drag' ){
      $(this).scrollTop( START_SCROLL_Y - ev.gesture.deltaY );
    }
    if( ev.type === 'release' ){
      $(this).animate({
        scrollTop: START_SCROLL_Y - ev.gesture.deltaY*ev.gesture.velocityY
      });
    }
    
    //console.info('drag');
    // $(this).parent().scrollTop( $(this).parent().scrollTop()-ev.gesture.velocityY*ev.gesture.deltaY );
    //$(this).parent().clearQueue().animate({
    //  scrollTop: -ev.gesture.deltaY
    //});
  });
})();

</script>

</body>
</html>